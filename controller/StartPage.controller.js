"use strict";sap.ui.define(["ui2/choosingtech/controller/BaseController","sap/ui/model/json/JSONModel","sap/ui/export/Spreadsheet"],function(t,e,o){"use strict";return t.extend("ui2.choosingtech.controller.StartPage",{onInit:function o(){t.prototype.init.apply(this,arguments);this.oRouter.getRoute("StartPage").attachPatternMatched(this.handleRouteMatched,this);this.oDialogModel=new e;this.getView().setModel(this.oDialogModel,"addModel")},handleRouteMatched:function t(){},onListItemPress:function t(e){var o=this.getOwnerComponent().getHelper().getNextUIState(1);var i=e.getSource();var a=i.getBindingContext("dataModel").getObject();this.goToPage("Detail",{layout:o.layout,transaction:a.id})},onAdd:function t(){this.getAddDialog().open()},getAddDialog:function t(){if(!this.addDialog){this.addDialog=sap.ui.xmlfragment(this.getView().getId(),"ui2.choosingtech.fragments.addDialog",this);this.addDialog.setModel(this.oDialogModel)}this.oDialogModel.setData({id:"",text:""});return this.addDialog},onAddOk:function t(){var e=this.getView().getModel("dataModel");var o=this.oDialogModel.getData();if(o.id){var i=e.getProperty("/transactions");i.push({id:o.id,text:o.text,technology:null,tech_text:"",cost:null,cost_text:""});e.setProperty("/transactions",i);this.getAddDialog().close()}else{this.showMessage("Введите транзакцию!")}},onAddCancel:function t(){this.getAddDialog().close()},getListItemInfo:function t(e,o){if(!o){return"Не выбрана целевая технология!"}if(!e){return"Не расчитаны трудозатраты!"}return"Готово!"},getListInfoState:function t(e,o){return e&&o?"Success":"Warning"},onExcelExport:function t(){var e=this.getView().getModel("dataModel").getData();if(e.name){this.export()}else{this.showMessage("Заполните имя!")}},export:function t(){var e=this.getView().getModel("dataModel").getData();var i=[{label:"Транзакция",property:"id",width:"30"},{label:"Описание",property:"text",width:"80"},{label:"Технология",property:"technology",width:"25"},{label:"Трудозатраты",property:"cost",width:"25"}];var a="".concat(e.name.replaceAll(" ","_"),"_").concat(e.department.replaceAll(" ","_"));var n={workbook:{columns:i},dataSource:e.transactions,fileName:a};var s=new o(n);s.build().then(function(){this.showMessage("Готово!")}.bind(this)).finally(s.destroy)}})});