var spreadsheet;var provider;var request;var origin=self.origin||"";importScripts(origin+"libs/uri.all.min.js");importScripts(origin+"XLSXBuilder.js");importScripts(origin+"../provider/DataProviderBase.js");importScripts(origin+"libs/JSZip3.js");if(!self.Promise){importScripts(origin+"libs/es6-promise.js");ES6Promise.polyfill()}self.onmessage=function(e){"use strict";if(e.data.cancel){if(request){request.cancel()}close();return}var r=e.data;spreadsheet=new XLSXBuilder(r.workbook.columns,r.workbook.context,r.workbook.hierarchyLevel,r.customconfig);provider=new DataProviderBase(r);if(!(provider instanceof DataProviderBase)){processCallback({error:"Invalid DataProvider - Export aborted"})}request=provider.requestData(processCallback)};function processCallback(e){"use strict";if(e.error){postMessage({error:e.error});close()}spreadsheet.append(e.rows);postMessage({progress:true,fetched:e.fetched,total:e.total});e.finished&&spreadsheet.build().then(saveSpreadsheet)}function saveSpreadsheet(e){"use strict";var r={finished:true,spreadsheet:e};postMessage(r,[r.spreadsheet]);close()}